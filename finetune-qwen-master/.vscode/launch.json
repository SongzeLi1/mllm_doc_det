{
    // 使用 IntelliSense 了解相关属性。 
    // 悬停以查看现有属性的描述。
    // 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python 调试程序: 当前文件",
            "type": "debugpy",
            "request": "launch",
            "program": "${file}",
            "console": "integratedTerminal",
            "env": {
                "CUDA_VISIBLE_DEVICES": "1",
                "IS_DEBUG": "1",
            },
        },
        {
            "name": "Python 调试程序: mertic",
            "type": "debugpy",
            "request": "launch",
            "program": "${workspaceFolder}/script/metric.py",
            "console": "integratedTerminal",
            "env": {
                "CUDA_VISIBLE_DEVICES": "1",
                "IS_DEBUG": "1",
            },
            "args": [
                "--analysis_path",
                "/home/yuyangxin/data/finetune-qwen/result/Qwen2.5-VL-7B-Instruct_sam2.1-hiera-base-plus_3box_MagicBrush_match_CASIAv2_20250515_1514_box3_pos0_cls_mask_expert/2025052307430",
                "--save_path",
                "/home/yuyangxin/data/finetune-qwen/result/Qwen2.5-VL-7B-Instruct_sam2.1-hiera-base-plus_3box_MagicBrush_match_CASIAv2_20250515_1514_box3_pos0_cls_mask_expert/summary.json",
            ]
        },
        {
            "name": "Python 调试程序: 单GPU inference",
            "type": "debugpy",
            "request": "launch",
            "program": "${workspaceFolder}/inference_llm.py",
            "console": "integratedTerminal",
            "env": {
                "CUDA_VISIBLE_DEVICES": "1",
                "IS_DEBUG": "1",
            },
            "args": [
                "--model",
                "Qwen/Qwen2.5-VL-3B-Instruct",
                "--adapters",
                "${workspaceFolder}/output/Qwen2.5-VL-3B-Instruct_sam2.1-hiera-base-plus_3box_MagicBrush_match_CASIAv2_20250515_1514_box3_pos0_cls_mask_expert/v2-20250516-081755/checkpoint-5730",
                "--sam_model_path",
                "/home/yuyangxin/data/finetune-qwen/sam_output/sam2.1-hiera-base-plus_3box_MIML_Part1_fake_CASIAv2_real-7437_20250430_0919/checkpoints/Epoch010.pt",
                "--template",
                "forensic_template",
                "--stream",
                "false",
                "--max_new_tokens",
                "2048",
                "--max_batch_size",
                "1",
                "--infer_backend",
                "pt",
                "--load_data_args",
                "true",
                "--add_mask_predict",
                "true",
                "--add_cls_predict",
                "true",
                "--add_expert_feat",
                "true",
                "--torch_dtype",
                "bfloat16",
                "--val_dataset",
                "/data0/yuyangxin/finetune-qwen/resource/datasets/test.json",
                "--system",
                "${workspaceFolder}/finetune/templates/system_with_reason.txt",
            ],
        },
        {
            "name": "Python 调试程序: 多GPU inference",
            "type": "debugpy",
            "request": "launch",
            "module": "torch.distributed.run",
            "env": {
                "CUDA_VISIBLE_DEVICES": "5,6",
                "IS_DEBUG": "1",
            },
            "args": [
                "--nproc_per_node=2", // 根据需要调整使用的 GPU 数量
                "--master_port=29600",
                "${workspaceFolder}/inference_llm.py",
                "--model",
                "Qwen/Qwen2.5-VL-3B-Instruct",
                "--adapters",
                "${workspaceFolder}/output/Qwen2.5-VL-3B-Instruct_sam_output_box3_pos1_cls_mask/v4-20250508-115623/checkpoint-5090",
                "--template",
                "forensic_template",
                "--stream",
                "false",
                "--max_new_tokens",
                "2048",
                "--max_batch_size",
                "1",
                "--infer_backend",
                "pt",
                "--load_data_args",
                "true",
                "--add_expert_feat",
                "false",
                "--torch_dtype",
                "bfloat16",
                "--system",
                "${workspaceFolder}/finetune/templates/system_with_reason.txt",
                "--val_dataset",
                "${workspaceFolder}/resource/datasets/without_instruct/valid.json",
            ],
        },
        {
            "name": "Python: Debug: 单GPU Train",
            "type": "debugpy",
            "request": "launch",
            "program": "${workspaceFolder}/sft_llm.py",
            "console": "integratedTerminal",
            "cwd": "${fileDirname}",
            "justMyCode": false,
            "env": {
                "CUDA_VISIBLE_DEVICES": "1",
                "IS_DEBUG": "1",
            },
            "args": [
                "--model",
                "Qwen/Qwen2.5-VL-7B-Instruct",
                "--template",
                "forensic_template",
                "--system",
                "${workspaceFolder}/finetune/templates/system_with_reason.txt",
                "--sam_model_path",
                "/home/yuyangxin/data/finetune-qwen/sam_output/sam2.1-hiera-base-plus_3box_MagicBrush_match_CASIAv2_20250515_1514/checkpoints/Epoch010.pt",
                "--add_expert_feat",
                "true",
                "--add_mask_predict",
                "true",
                "--add_cls_predict",
                "true",
                "--token_pos",
                "0",
                "--expert_model_weight_path",
                "${workspaceFolder}/resource/weight/nprmodel.pth",
                "--dataset",
                "${workspaceFolder}/resource/datasets/with_instruct/CASIAv2_fake_with_instruct.json",
                "--split_dataset_ratio",
                "0",
                "--attn_impl",
                "flash_attn",
                "--split_dataset_ratio",
                "0",
                "--data_seed",
                "42",
                "--train_type",
                "lora",
                "--torch_dtype",
                "bfloat16",
                "--num_train_epochs",
                "10",
                "--per_device_train_batch_size",
                "1",
                "--per_device_eval_batch_size",
                "1",
                "--padding_side",
                "left",
                "--modules_to_save",
                "embed_tokens",
                "cls_head",
                "mask_head",
                "--learning_rate",
                "1e-4",
                "--lora_rank",
                "8",
                "--lora_alpha",
                "32",
                "--target_modules",
                "all-linear",
                "--freeze_vit",
                "true",
                "--gradient_accumulation_steps",
                "1",
                "--eval_steps",
                "1",
                "--save_steps",
                "1",
                "--save_total_limit",
                "1",
                "--logging_steps",
                "5",
                "--max_length",
                "2048",
                "--warmup_ratio",
                "0.05",
                "--dataloader_num_workers",
                "1",
                "--dataset_num_proc",
                "1",
                "--output_dir",
                "${workspaceFolder}/test_output",
            ]
        },
        {
            "name": "Python: Debug: 多GPU Train",
            "type": "debugpy",
            "request": "launch",
            "module": "torch.distributed.run",
            "console": "integratedTerminal",
            "cwd": "${fileDirname}",
            "justMyCode": false,
            "env": {
                "CUDA_VISIBLE_DEVICES": "1,2,3",
                "IS_DEBUG": "1",
            },
            "args": [
                "--nproc_per_node=3", // 根据需要调整使用的 GPU 数量
                "${workspaceFolder}/sft_llm.py",
                "--model",
                "Qwen/Qwen2.5-VL-3B-Instruct",
                "--template",
                "forensic_template",
                "--system",
                "${workspaceFolder}/finetune/templates/system_with_reason.txt",
                "--add_expert_feat",
                "false",
                "--add_mask_predict",
                "true",
                "--bce_weight",
                "0.005",
                "--dice_weight",
                "0.5",
                "--dataset",
                "${workspaceFolder}/resource/datasets/with_instruct/CASIAv2_real_with_instruct.json",
                "${workspaceFolder}/resource/datasets/with_instruct/CASIAv2_fake_with_instruct.json",
                "--attn_impl",
                "flash_attn",
                "--split_dataset_ratio",
                "0",
                "--data_seed",
                "42",
                "--train_type",
                "lora",
                "--torch_dtype",
                "bfloat16",
                "--num_train_epochs",
                "20",
                "--per_device_train_batch_size",
                "2",
                "--per_device_eval_batch_size",
                "1",
                "--padding_side",
                "left",
                "--modules_to_save",
                "embed_tokens",
                "lm_head",
                "cls_head",
                "mask_head",
                "--learning_rate",
                "1e-4",
                "--lora_rank",
                "8",
                "--lora_alpha",
                "32",
                "--target_modules",
                "all-linear",
                "--freeze_vit",
                "true",
                "--gradient_accumulation_steps",
                "16",
                "--eval_steps",
                "2",
                "--save_steps",
                "2",
                "--save_total_limit",
                "10",
                "--logging_steps",
                "5",
                "--max_length",
                "2048",
                "--warmup_ratio",
                "0.05",
                "--dataloader_num_workers",
                "1",
                "--dataset_num_proc",
                "1",
                "--output_dir",
                "${workspaceFolder}/test_output",
                "--deepspeed",
                "zero2",
            ]
        },
        {
            "name": "Python: Debug: 多GPU Train without mask",
            "type": "debugpy",
            "request": "launch",
            "module": "torch.distributed.run",
            "console": "integratedTerminal",
            "cwd": "${fileDirname}",
            "justMyCode": false,
            "env": {
                "CUDA_VISIBLE_DEVICES": "1,2,3",
                "CUDA_LAUNCH_BLOCKING": "1",
                "IS_DEBUG": "1",
            },
            "args": [
                "--nproc_per_node=3", // 根据需要调整使用的 GPU 数量
                "${workspaceFolder}/sft_llm.py",
                "--model",
                "Qwen/Qwen2.5-VL-3B-Instruct",
                "--template",
                "forensic_template",
                "--system",
                "${workspaceFolder}/finetune/templates/system_with_reason.txt",
                "--add_expert_feat",
                "false",
                "--add_mask_predict",
                "false",
                "--bce_weight",
                "0.005",
                "--dice_weight",
                "0.5",
                "--dataset",
                "${workspaceFolder}/resource/datasets/with_instruct/CASIAv2_fake_with_instruct.json",
                "--attn_impl",
                "flash_attn",
                "--split_dataset_ratio",
                "0",
                "--data_seed",
                "42",
                "--train_type",
                "lora",
                "--torch_dtype",
                "bfloat16",
                "--num_train_epochs",
                "20",
                "--per_device_train_batch_size",
                "1",
                "--per_device_eval_batch_size",
                "1",
                "--padding_side",
                "left",
                "--modules_to_save",
                "embed_tokens",
                "lm_head",
                "cls_head",
                "--learning_rate",
                "1e-4",
                "--lora_rank",
                "8",
                "--lora_alpha",
                "32",
                "--target_modules",
                "all-linear",
                "--freeze_vit",
                "true",
                "--gradient_accumulation_steps",
                "8",
                "--eval_steps",
                "2",
                "--save_steps",
                "2",
                "--save_total_limit",
                "10",
                "--logging_steps",
                "5",
                "--max_length",
                "2048",
                "--warmup_ratio",
                "0.05",
                "--dataloader_num_workers",
                "1",
                "--dataset_num_proc",
                "1",
                "--output_dir",
                "${workspaceFolder}/test_output",
                "--deepspeed",
                "zero2",
            ]
        },
        {
            "name": "Python: Debug: 单GPU Train SAM",
            "type": "debugpy",
            "request": "launch",
            "program": "${workspaceFolder}/finetune_sam.py",
            "console": "integratedTerminal",
            "cwd": "${fileDirname}",
            "justMyCode": false,
            "env": {
                "CUDA_VISIBLE_DEVICES": "4",
                "IS_DEBUG": "1",
            },
            "args": [
                "--dataset_paths",
                "${workspaceFolder}/resource/datasets/without_instruct/MagicBrush_match.json",
                "--ds_config",
                "${workspaceFolder}/configs/ds_config.json",
                "--save_dir",
                "./sam_save_path",
                "--batch_size",
                "16",
            ]
        },
        {
            "name": "Python: Debug: 单GPU Inference SAM",
            "type": "debugpy",
            "request": "launch",
            "program": "${workspaceFolder}/inference_sam.py",
            "console": "integratedTerminal",
            "cwd": "${fileDirname}",
            "justMyCode": false,
            "env": {
                "CUDA_VISIBLE_DEVICES": "3",
                "IS_DEBUG": "1",
            },
            "args": [
                "--dataset_paths",
                "${workspaceFolder}/resource/datasets/without_instruct/columbia.json",
                "--checkpoint",
                "${workspaceFolder}/sam_output/sam2.1-hiera-tiny_3box_MIML_Part1_fake_CASIAv2_real-7437_20250514_1512/checkpoints/Epoch010.pt",
                "--batch_size",
                "16",
            ]
        },
        {
            "name": "Python: Debug: 多GPU Inference SAM",
            "type": "debugpy",
            "request": "launch",
            "module": "torch.distributed.run",
            "console": "integratedTerminal",
            "justMyCode": false,
            "env": {
                "CUDA_VISIBLE_DEVICES": "1",
                "IS_DEBUG": "1",
            },
            "args": [
                "--nproc_per_node=1",
                "--master_port=29505",
                "${workspaceFolder}/inference_sam.py",
                "--dataset_paths",
                "${workspaceFolder}/resource/datasets/without_instruct/smartedit.json",
                "--checkpoint",
                "${workspaceFolder}/sam_save_path/sam2-hiera-tiny_3box_valid_20250429_1900/checkpoints/Epoch010.pt",
                "--batch_size",
                "16",
            ]
        },
        {
            "name": "Python: Debug: 多GPU Train SAM",
            "type": "debugpy",
            "request": "launch",
            "module": "torch.distributed.run",
            "console": "integratedTerminal",
            "cwd": "${fileDirname}",
            "justMyCode": false,
            "env": {
                "CUDA_VISIBLE_DEVICES": "4,7",
                "IS_DEBUG": "1",
            },
            "args": [
                "--nproc_per_node=2",
                "--master_port=29505",
                "${workspaceFolder}/finetune_sam.py",
                "--dataset_paths",
                "${workspaceFolder}/resource/datasets/without_instruct/valid.json",
                "--ds_config",
                "${workspaceFolder}/configs/ds_config.json",
                "--save_dir",
                "./sam_save_path",
                "--batch_size",
                "16",
            ]
        },
        {
            "name": "Python: Debug: 单GPU Train LLM",
            "type": "debugpy",
            "request": "launch",
            "program": "${workspaceFolder}/sft_llm.py",
            "console": "integratedTerminal",
            "cwd": "${fileDirname}",
            "justMyCode": false,
            "env": {
                "CUDA_VISIBLE_DEVICES": "6",
                "IS_DEBUG": "1",
            },
            "args": [
                "--model",
                "Qwen/Qwen2.5-VL-7B-Instruct",
                "--template",
                "controllable_template",
                "--system",
                "${workspaceFolder}/finetune/templates/forensic_template.txt",
                "--sam_model_path",
                "/home/yuyangxin/data/finetune-qwen/sam_output/sam2.1-hiera-base-plus_3box_MagicBrush_match_CASIAv2_20250515_1514/checkpoints/Epoch010.pt",
                "--add_expert_feat",
                "true",
                "--add_mask_predict",
                "true",
                "--add_cls_predict",
                "true",
                "--token_pos",
                "0",
                "--expert_model_weight_path",
                "${workspaceFolder}/resource/weight/nprmodel.pth",
                "--dataset",
                "/home/yuyangxin/data/finetune-qwen/resource/datasets/with_instruct/FragFake_train_hard.json",
                "--split_dataset_ratio",
                "0",
                "--attn_impl",
                "flash_attn",
                "--split_dataset_ratio",
                "0",
                "--data_seed",
                "42",
                "--train_type",
                "lora",
                "--torch_dtype",
                "bfloat16",
                "--num_train_epochs",
                "10",
                "--per_device_train_batch_size",
                "1",
                "--per_device_eval_batch_size",
                "1",
                "--padding_side",
                "left",
                "--modules_to_save",
                "embed_tokens",
                "cls_head",
                "mask_head",
                "--learning_rate",
                "1e-4",
                "--lora_rank",
                "8",
                "--lora_alpha",
                "32",
                "--target_modules",
                "all-linear",
                "--freeze_vit",
                "true",
                "--gradient_accumulation_steps",
                "1",
                "--eval_steps",
                "1",
                "--save_steps",
                "1",
                "--save_total_limit",
                "1",
                "--logging_steps",
                "5",
                "--max_length",
                "2048",
                "--warmup_ratio",
                "0.05",
                "--dataloader_num_workers",
                "1",
                "--dataset_num_proc",
                "1",
                "--output_dir",
                "${workspaceFolder}/test_output",
                "--dataset_type",
                "controllable"
            ]
        },
    ]
}